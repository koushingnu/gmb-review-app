# 🚀 MVP Phase 1: レビュー一覧 - チェックリスト

## 📋 フェーズ概要
最小限のPoCとして、まずは**レビュー一覧**機能のみを完璧に動作させます。

### 段階的リリース計画
- **Phase 1**: レビュー一覧 ✅ (現在)
- **Phase 2**: AI自動返信 🔜
- **Phase 3**: AI分析 🔜

---

## ✅ 完了済み作業

### 1. メニューの整理
- [x] SidebarのnavItemsを「口コミ一覧」のみに絞る
- [x] 将来実装予定の機能をコメントアウト

### 2. AI再評価機能の修正
- [x] `atmosphere`カラム問題を修正（存在しないカラムを参照していた）
- [x] 正しいカラム名に統一：`taste_score`, `service_score`, `hygiene_score`, `location_score`, `price_score`
- [x] `sync/route.js`と`ai-rescore/route.js`の両方を修正

---

## 🔧 実施が必要な作業

### 3. Supabaseスキーマキャッシュのリフレッシュ ⚠️ **重要**

#### エラーの原因
```
Could not find the 'atmosphere' column of 'reviews' in the schema cache
```

このエラーは、Supabaseが古いスキーマ情報をキャッシュしているために発生しています。

#### 解決方法（以下のいずれかを実行）

**方法A: Supabase Dashboardから実行（推奨）**
1. Supabase Dashboardにアクセス
   https://supabase.com/dashboard/project/oandetwzkdyrhqfieutg/sql/new
2. SQL Editorで以下を実行：
   ```sql
   NOTIFY pgrst, 'reload schema';
   ```
3. 実行後、ブラウザでページをリロード

**方法B: 開発サーバーを再起動**
```bash
# 開発サーバーを停止 (Ctrl+C)
# 再起動
npm run dev
```

**方法C: Vercelで環境変数を変更**
- Vercel Dashboardで環境変数を一度削除・再追加すると、キャッシュがクリアされます

---

## 📝 Phase 1 完成後の動作確認

### レビュー一覧機能のテスト項目

#### 基本表示
- [ ] レビュー一覧が正しく表示される
- [ ] 評価（星）が正しく表示される
- [ ] レビュー日時が正しく表示される
- [ ] レビュアー名が正しく表示される
- [ ] レビューコメントが正しく表示される

#### AI評価機能
- [ ] AI再評価ボタンが表示される
- [ ] AI再評価ボタンをクリックしてエラーが出ない
- [ ] 5項目評価（味・サービス・衛生・立地・価格）が正しく表示される
- [ ] 377件全てのレビューが正常に処理される

#### フィルター・ソート機能
- [ ] 日付フィルターが動作する
- [ ] ソート機能が動作する
- [ ] 同期ボタンが動作する

#### Google認証
- [ ] トークンが有効な場合、正常に動作する
- [ ] トークンが無効な場合、再認証アラートが表示される
- [ ] 再認証ボタンから正常に認証できる

#### レスポンシブ対応
- [ ] スマートフォンで正しく表示される
- [ ] タブレットで正しく表示される
- [ ] デスクトップで正しく表示される

#### パフォーマンス
- [ ] ページ読み込みが3秒以内
- [ ] レビュー同期が30秒以内
- [ ] AI再評価が適切な速度で進行する

---

## 🐛 既知の問題と対応

### 1. OpenAI API Rate Limit
**症状**: `429 Rate limit reached for gpt-4`

**対策**:
- `ai-rescore/route.js`で0.5秒の待機時間を設定済み
- 必要に応じて待機時間を1秒に延長

### 2. Supabase Schema Cache
**症状**: `Could not find the 'atmosphere' column`

**対策**:
- 上記「3. Supabaseスキーマキャッシュのリフレッシュ」を実施

---

## 📊 Phase 1 完成後の次のステップ

Phase 1が完璧に動作したら、以下のフェーズに進みます：

### Phase 2: AI自動返信
- レビューへの自動返信生成
- 返信の編集・送信機能
- 返信履歴の管理

### Phase 3: AI分析
- 分析グラフの表示
- 四半期比較
- 総評の生成

---

## 🔍 デバッグ情報

### ローカル環境で確認
```bash
# 開発サーバー起動
npm run dev

# ブラウザで確認
http://localhost:3000
```

### ログの確認
- ブラウザのDevToolsコンソール
- ターミナルのサーバーログ

### 問題が発生した場合
1. ブラウザのキャッシュをクリア
2. 開発サーバーを再起動
3. Supabaseのスキーマキャッシュをリフレッシュ
4. 環境変数が正しく設定されているか確認

---

## 📅 更新履歴

- 2024-11-16: MVP Phase 1 開始
  - Sidebarメニューをレビュー一覧のみに絞る
  - AI再評価のatmosphereカラム問題を修正
  - Phase 1チェックリストを作成

